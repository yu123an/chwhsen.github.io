---
title: 调用百度人脸识别筛选图片
guid: urn:uuid:e2edcaac-f015-41b2-a175-712141f1e55a
tags: linux spider
layout: post
---
今天搞了一下百度云的人脸识别`API`，判断给定的照片里是否含有女性面孔，并根据面孔给出人物年龄以及颜值打分。

![](https://ws3.sinaimg.cn/large/005BYqpggy1fxkmw8suxmj30i607zjrm.jpg)

如图所示，可以通过两种方式来输入图片的`url`地址，可以将地址写入文件，也可以提交单一地址，会自动返回图片链接，人物的年龄和性别。

但是这个打分标准和审美还是有一定差距的，比如

![](https://ww4.sinaimg.cn/mw690/9d52c073gw1e9sqvgtrd3j20go0oddi1.jpg)
![](https://ww3.sinaimg.cn/mw1024/9d52c073gw1f58mhojtdhj20j60piq5w.jpg)

分别给了`82.28`和`99.13`的评分。

再结合`linux`下的`ImageMagisk`可以标注人物的标志点，只是效果有点儿，莫名其妙的多了两张面孔

![](https://i.loli.net/2018/11/25/5bfaa8029c1a5.jpg)

人脸识别

```bash
#!/bin/bash
token=$(curl -k 'https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=QPprSIxxxxxxxO68FYRLzye&client_secret=ERvXATsxxxxxxxkK5V0Kab2xxxbW' | jq -r '.access_token')
function judge ()
{
pic_url=$1
curl -k "https://aip.baidubce.com/rest/2.0/face/v3/detect?access_token=$token" \
--data "image=$pic_url&image_type=URL&max_face_num=8&face_field=age,beauty,face_shape,face_type,gender,race,quality" \
-H 'Content-Type:application/json; charset=UTF-8' > /pic/face.tmp

num=$(cat /pic/face.tmp | jq -r '.result.face_num')
for (( i=0;i<$num;i++))
do
xingbie=$(jq -r .result.face_list[$i].gender.type  /pic/face.tmp)
if [ $xingbie = "female" ];then
	age=$(jq -r .result.face_list[$i].age /pic/face.tmp)
	mei=$(jq -r .result.face_list[$i].beauty /pic/face.tmp)
	echo -e "-----------\nLink:$pic_url\nNianling:$age\nYanzhi:$mei"
fi
done
}
echo "+---------------------------------------------------+"
echo "|              1.)读取文件中的图片url列表           |"
echo "|- - - - - - - - - - - - - - - - - - - - - - - - - -|"
echo "|              2.)手动输入图片url列表               |"
echo "+---------------------------------------------------+"
read -p "请选择：" select
if [ $select = "1" ];then
read -p "请输入文件位置：" add
for url in $(cat $add | sed ':a;N;$!ba;s/\n/ /g')
do
judge $url
sleep 1s
done
elif [ $select = "2" ];then
read -p "请输入图片地址：" url
judge $url
fi 
```

添加标志点

```bash
#!/bin/bash
for url in $(cat /pic/mzi.log | sed ':a;N;$!ba;s/\n/ /g')
do
name=$(echo $url | sed 's#/#_#g')
echo $name
wget -o- $url -O /pic/faces/$name
curl -k "https://aip.baidubce.com/rest/2.0/face/v3/detect?access_token=24.351xxxxxxxxxx561eeb902b5fa.2592000.1545xxxx25.282335-147xxxxx6" \
--data "image=$url&image_type=URL&max_face_num=8&face_field=landmark" \
-H 'Content-Type:application/json; charset=UTF-8' | \
jq '.result.face_list[] | .landmark,.landmark72' | grep : | sed 's/.*: //g' | sed ':a;N;$!ba;s/,\n/,/g' > /pic/point.tmp
for dot in $(cat /pic/point.tmp | sed ':a;N;$!ba;s/\n/ /g')
do
convert /pic/faces/$name \
 -fill green -pointsize 25 \
-font DejaVu-Sans \
-draw "text $dot '.'"  /pic/faces/$name
done
done
```

